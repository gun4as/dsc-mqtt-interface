# DSC MQTT Interface

ESP8266 projekts, kas pieslēdzas DSC signalizācijas panelim caur Keybus un nosūta statusus uz MQTT brokeri, kā ari saņem komandas no Home Assistant vai citas automatizācijas sistēmas.

---

## Sistēmas prasības

- ESP8266 mikrokontrolleris (piemēram, D1 Mini)
- DSC signalizācijas panelis ar Keybus
- MQTT brokeris (piem., Mosquitto)
- PlatformIO (VSCode paplašinājums)

---

## Instalācija

1. **Klonē repozitoriju**

   Atver VSCode un klonē repozitoriju ar PlatformIO projektu.

2. **Sagato konfigurācijas failu**

   Fails `src/config_template.cpp` satur paraugvērtības WiFi, MQTT un citiem parametriem.

   - Nokopē šo failu uz `src/config.cpp`.
   - Atver `src/config.cpp` un aizpildi ar saviem uzstādījumiem:

     ```cpp
     const char * wifiSSID = "Tavs_WiFi";
     const char * wifiPassword = "Tava_parole";
     const char * accessCode = "1234";
     const char * mqttServer = "192.168.1.10";
     const char * mqttUsername = "mqtt";
     const char * mqttPassword = "parole";
     const int mqttPort = 1883;
     ```

   **Svarīgi:** Fails `config.cpp` ir ignorēts `.gitignore` un netiks iekļauts repozitorijā.

3. **Kompilē un augšupielādē uz ESP8266**

   Atver PlatformIO un nospied **Upload** (bultiņas ikona) vai lieto PlatformIO komandu:

   ```bash
   platformio run
   platformio upload
   ```

4. **Atver seriālo monitoru** un pārliecinies, ka ierīce pieslēdzas WiFi un MQTT.

---

## MQTT Topiki (saņem/šāna)

| Tēma | Apraksts |
|-------|----------|
| `DSC/Get/Zone1 ... Zone64` | Zonēm individuāli |
| `DSC/Get/Partition1 ...` | Partition statusi |
| `DSC/Get/Trouble` | Traucējumu ziņojumi |
| `DSC/Set/Partition1` | Komandas: arm, disarm u.c. |

---

## Iespējamās problēmas

- Ja WiFi nepieejams, ierīce mēģina atkārtoti pieslēgties.
- Ja MQTT brokeris nepieejams, tas mēģina automātiski pārslēgties.
- Pēc vairākiem neveiksmīgiem mēģinājumiem ESP automātiski restartējas.

---

## Drošība

Fails `config.cpp` satur sensitīvus datus (WiFi, MQTT paroles), tāpēc tas **netiek augšupielādēts** repozitorijā.
Neesi to koplietot publiski!

---

## Plānotie uzlabojumi

- Web konfigurācijas saskarne (hotspot + WiFi/MQTT setup)
- OTA atjaunināšana
- Logs un sistēmas diagnostika caur MQTT

---

## Licence

Projekts tiek izplatīts saskaņā ar GNU GPL v3 licenci.

<https://github.com/taligentx/dscKeybusInterface>

---


